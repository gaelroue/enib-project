<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Control AT91SAM9261-EK board with WebSocket</title>
  <link rel="stylesheet" type="text/css" href="../style.css" />
  <script src="gauge.js"></script>
  <script>
    var ws;

    function appendTxtNode(msg) {
        var txtNode = document.createTextNode(msg);
        var brNode = document.createElement('br');
        var cnode = document.getElementById('log');
        cnode.appendChild(txtNode);
        cnode.appendChild(brNode);
    }
    function doSend() {
        var msg = document.getElementById('sendmsg').value;
        if (!msg.length) {
            return;
        }
        ws.send(msg);
        document.getElementById('sendmsg').value='';
    }
    function init() {
        ws = new WebSocket('ws://127.0.0.1/board');
        ws.onopen = function(e) {
            appendTxtNode('WebSocket opened');
        };
        ws.onmessage = function(msg) {
        	ul = document.getElementById('content.ul');
		while (ul.hasChildNodes()) {
			ul.removeChild(ul.lastChild);
		}

		data = JSON.parse(msg.data);

		for (i = 0; i < data.nb_sensor; i++) {
			li = document.createElement('li');
			li.innerHTML="Sensor id : "+ data.sensor[i].id;
			ul.appendChild(li);
		}
        };
        ws.onclose = function(e) {
            appendTxtNode('WebSocket closed');
        };
    }
  </script>
</head>
<body onload="init()">
  <h1>AT91SAM9261-EK development board</h1>
  <div id="banner"></div>
  <div id="contents">
    <table>
    <tr><th>show cpu workload (%)</th></tr>
    <tr><td>
		    <div id="content"><ul id="content.ul"></ul></div>
    </td></tr>
    <tr><th>websocket log</th></tr>
    <tr><td>
      <div id="log"></div>
    </td></tr>
    </table>
  </div>
</body>
</html>
