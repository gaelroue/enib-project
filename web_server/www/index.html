<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Electronique Project</title>
  <link rel="stylesheet" type="text/css" href="style.css" />
  <script src="gauge.js"></script>
  <script>
    var ws;

    function appendTxtNode(msg) {
        var txtNode = document.createTextNode(msg);
        var brNode = document.createElement('br');
        var cnode = document.getElementById('log');
        cnode.appendChild(txtNode);
        cnode.appendChild(brNode);
    }
    function doSend(id) {
        var msg = document.getElementById('sendmsg'+id).value;
        if (!msg.length) {
            return;
        }
        ws.send(id+','+msg);
        document.getElementById('sendmsg'+id).value='';
    }
    function activeCamera() {
        ws.send("255,255");
    }
     function init_FPGA() {
        ws.send("250,250");
    }


	function progressFn(value, type, id)
	{
        	div = document.getElementById(id);

		ul = document.createElement('ul');
		li = document.createElement('li');

		li.innerHTML="Sensor id : "+ id;
		ul.appendChild(li);
		li = document.createElement('li');
		progress = document.createElement('progress');
		progress.max = 50;
		progress.min = -10;
		progress.value = value;
		li.appendChild(progress);
		ul.appendChild(li);

		li = document.createElement('li');

		li.innerHTML=value+ "Â°";
		ul.appendChild(li);

		div.appendChild(ul);


	}

	function gaugeFn(data, type)
	{
        	div = document.getElementById(data.id);

		ul = document.createElement('ul');
		li = document.createElement('li');

		li.innerHTML="Sensor id : "+ data.id;
		ul.appendChild(li);
		div.appendChild(ul);

		li = document.createElement('li');

		canvas = document.createElement('canvas');
		canvas.id = 'gauge'+data.id;
		canvas.width = 300;
		canvas.height = 300;
		li.appendChild(canvas);
		ul.appendChild(li);
		div.appendChild(ul);
		var gauge=new Gauge('gauge'+data.id, data.type);
		gauge.draw(data.value);


	}

		function gaugePotarFn(data, type)
	{
        	div = document.getElementById(data.id);

		ul = document.createElement('ul');
		li = document.createElement('li');

		li.innerHTML="Sensor id : "+ data.id;
		ul.appendChild(li);
		div.appendChild(ul);

		li = document.createElement('li');
		ul.appendChild(li);
		li.innerHTML="Potentiometre 1 : " + data.value[0];

		li = document.createElement('li');
		ul.appendChild(li);
		li.innerHTML="Potentiometre 2 : " + data.value[1];


	}

	function gyroFn(value, id)
{
        	div = document.getElementById(id);

		ul = document.createElement('ul');
		li = document.createElement('li');

		li.innerHTML="Sensor id : "+ id;
		ul.appendChild(li);
		div.appendChild(ul);

		li = document.createElement('li');
		ul.appendChild(li);
		li.innerHTML="Accelerometre : "+ value[0]+ ' x,'+ value[1]+ ' y,'+ value[2]+' z';

}

	function displayInput(id)
	{
			td = document.getElementById("td"+id);
			input = document.createElement('input');
			input.id = 'sendmsg'+id;
			input.type = 'number';
			// input.onChange = doSend(id);
			td.appendChild(input);
			button = document.createElement('button');
			button.setAttribute( "onClick", "javascript: doSend("+id+");");
			button.innerHTML = 'Send';
			td.appendChild(button);
	}


	function displaySensors(data)
	{
		tr = document.getElementById('sensors.tr');
		for (i = 0; data.sensor[i]; i++) {
			if (document.getElementById(data.sensor[i].id))
			{
				div = document.getElementById(data.sensor[i].id)
				while (div.hasChildNodes()) {
					div.removeChild(div.firstChild);
				}
			switch(data.sensor[i].type)
			{
				case 2:
					gaugeFn(data.sensor[i], type)
				break;
				case 1:
					progressFn(data.sensor[i].value, type, data.sensor[i].id);
				break;
				case 3:
					gyroFn(data.sensor[i].value, data.sensor[i].id);
				break;
				case 4:
					gaugePotarFn(data.sensor[i], type)
				break;

			}

				continue;
			}

			td = document.createElement('td');
			td.id = "td"+data.sensor[i].id;
			switch(data.sensor[i].type)
			{
				case 2:
					div = document.createElement('div');
					type = "light";
					div.id = data.sensor[i].id;
					td.appendChild(div);
					tr.appendChild(td);
					displayInput(data.sensor[i].id);

				break;
				case 1:
					div = document.createElement('div');
					type = "temperature";
					div.id = data.sensor[i].id;
					td.appendChild(div);
					tr.appendChild(td);
					displayInput(data.sensor[i].id);
				break;
				case 4:
					div = document.createElement('div');
					type = "potard";
					div.id = data.sensor[i].id;
					td.appendChild(div);
					tr.appendChild(td);
					displayInput(data.sensor[i].id);
				break;
				case 3:
					div = document.createElement('div');
					type = "accelerometre";
					div.id = data.sensor[i].id;
					td.appendChild(div);
					tr.appendChild(td);
					displayInput(data.sensor[i].id);
//					gaugeFn(data.sensor[i], type)
				break;

			}
			
		}
	}

    function init() {
        ws = new WebSocket('ws://127.0.0.1:8080/api');
	//ws.onopen = function(e) {
        //    appendTxtNode('WebSocket opened');
        //};
        ws.onmessage = function(msg) {
		data = JSON.parse(msg.data);

		displaySensors(data);
        };
        ws.onclose = function(e) {
            appendTxtNode('WebSocket closed');
        };
    }
  </script>
</head>
<body onload="init()">
  <h1>Sensors Board</h1>
  <div id="camera">      
	        <button onClick="activeCamera()">Camera</button>
  </div>
  <div id="FPGA">      
	        <button onClick="init_FPGA()">init FPGA</button>
  </div>
  <div id="contents">
    <table>
    <tr><th>Sensors</th></tr>
    <tr id="sensors.tr">
	    <!--td><div id="temperature"></div></td>
	    <td><div id="light"></div></td>
	    <td><div id="potard"></div></td>
	    <td><div id="accelerometre"></div></td-->
   <!--td>
		    <div id="sensors"><ul id="sensors.ul"></ul></div>
		    <div><canvas id="gauge" width="300" height="300"></div>
    </td-->
    </tr>
    </table>
  </div>
</body>
</html>
