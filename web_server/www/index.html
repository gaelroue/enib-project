<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Electronique Project</title>
  <link rel="stylesheet" type="text/css" href="style.css" />
  <script src="gauge.js"></script>
  <script>
    var ws;

    function appendTxtNode(msg) {
        var txtNode = document.createTextNode(msg);
        var brNode = document.createElement('br');
        var cnode = document.getElementById('log');
        cnode.appendChild(txtNode);
        cnode.appendChild(brNode);
    }
    function doSend() {
        var msg = document.getElementById('sendmsg').value;
        if (!msg.length) {
            return;
        }
        ws.send(msg);
        document.getElementById('sendmsg').value='';
    }

	function progressFn(value, type)
	{
        	div = document.getElementById(type);
		progress = document.createElement('progress');
		progress.max = 50;
		progress.min = -10;
		progress.value = value;
		div.appendChild(progress);


	}

	function gaugeFn(data, type)
	{
        	div = document.getElementById(type);

		ul = document.createElement('ul');
		li = document.createElement('li');

		li.innerHTML="Sensor id : "+ data.id;
		ul.appendChild(li);
		div.appendChild(ul);

		li = document.createElement('li');

		canvas = document.createElement('canvas');
		canvas.id = 'gauge'+data.id;
		canvas.width = 300;
		canvas.height = 300;
		li.appendChild(canvas);
		ul.appendChild(li);
		div.appendChild(ul);
		var gauge=new Gauge('gauge'+data.id, data.type);
		gauge.draw(data.value);


	}


	function displaySensors(data)
	{
		tr = document.getElementById('sensors.tr');
		for (i = 0; data.sensor[i]; i++) {
			td = document.createElement('td');
			switch(data.sensor[i].type)
			{
				case 2:
					div = document.createElement('div');
					type = "light";
					div.id = type;
					td.appendChild(div);
					tr.appendChild(td);
					gaugeFn(data.sensor[i], type)
				break;
				case 1:
					div = document.createElement('div');
					type = "temperature";
					div.id = type;
					td.appendChild(div);
					tr.appendChild(td);
					progressFn(data.sensor[i].value, type);
				break;
				case 4:
					div = document.createElement('div');
					type = "potard";
					div.id = type;
					td.appendChild(div);
					tr.appendChild(td);
					gaugeFn(data.sensor[i], type)
				break;
				case 3:
					div = document.createElement('div');
					type = "accelerometre";
					div.id = type;
		ul = document.createElement('ul');
		li = document.createElement('li');

		li.innerHTML="Sensor id : "+ data.sensor[i].id;
		ul.appendChild(li);
		div.appendChild(ul);

		li = document.createElement('li');
		ul.appendChild(li);
		li.innerHTML="Accelero : "+ data.sensor[i].value[0]+ " x,"+ data.sensor[i].value[1]+ " y,"+ data.sensor[i].value[2]+" z";

					td.appendChild(div);
					tr.appendChild(td);
//					gaugeFn(data.sensor[i], type)
				break;

			}
			
		}
	}

    function init() {
        ws = new WebSocket('ws://192.168.0.2/api');
	//ws.onopen = function(e) {
        //    appendTxtNode('WebSocket opened');
        //};
        ws.onmessage = function(msg) {
        	tr = document.getElementById('sensors.tr');
		while (tr.hasChildNodes()) {
			tr.removeChild(tr.lastChild);
		}

		data = JSON.parse(msg.data);

		displaySensors(data);
        };
        ws.onclose = function(e) {
            appendTxtNode('WebSocket closed');
        };
    }
  </script>
</head>
<body onload="init()">
  <h1>Sensors Board</h1>
  <div id="banner"></div>
  <div id="contents">
    <table>
    <tr><th>Sensors</th></tr>
    <tr id="sensors.tr">
	    <!--td><div id="temperature"></div></td>
	    <td><div id="light"></div></td>
	    <td><div id="potard"></div></td>
	    <td><div id="accelerometre"></div></td-->
   <!--td>
		    <div id="sensors"><ul id="sensors.ul"></ul></div>
		    <div><canvas id="gauge" width="300" height="300"></div>
    </td-->
    </tr>
    </table>
  </div>
</body>
</html>
